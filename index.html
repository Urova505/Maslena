<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ú–∞—Å–ª–µ–Ω–∏—Ü–∞: –ª–æ–≤–∏ –±–ª–∏–Ω—ã!</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: none; }
        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', cursive, sans-serif;
            overflow: hidden;
            background: #FFE4B5;
            user-select: none;
            -webkit-user-select: none;
        }
        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-image: url('images/1.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        #gameCanvas { display: block; width: 100%; height: 100%; }
        .ui-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }
        .score-board {
            position: absolute; top: 20px; left: 20px;
            background: rgba(255,255,255,0.95); padding: 15px 25px;
            border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-size: 24px; font-weight: bold; color: #FF6B6B;
            border: 3px solid #FFD93D; z-index: 20;
        }
        .lives-board {
            position: absolute; top: 20px; right: 20px;
            background: rgba(255,255,255,0.95); padding: 15px 25px;
            border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-size: 24px; font-weight: bold; color: #FF6B6B;
            border: 3px solid #6BCB77; z-index: 20;
        }
        .start-screen, .game-over-screen, .win-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            z-index: 100; pointer-events: auto;
        }
        .start-screen h1, .game-over-screen h1, .win-screen h1 {
            color: #FFD93D; font-size: 50px; text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 30px; text-align: center; padding: 0 20px;
            animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-15px)} }
        .mode-buttons { display: flex; gap: 20px; margin-top: 30px; flex-wrap: wrap; justify-content: center; }
        .btn {
            padding: 20px 40px; font-size: 24px; border: none; border-radius: 50px;
            cursor: pointer; font-family: inherit; font-weight: bold;
            transition: all 0.2s; box-shadow: 0 6px 0 rgba(0,0,0,0.2); outline: none;
        }
        .btn:active { transform: translateY(6px); box-shadow: 0 0 0 rgba(0,0,0,0.2); }
        .btn-slow { background: #6BCB77; color: white; }
        .btn-medium { background: #FFD93D; color: #333; }
        .btn:hover { transform: scale(1.05); }
        .pause-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 40; display: none; pointer-events: none;
        }
        .quiz-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
            background: white; padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); max-width: 600px; width: 90%;
            z-index: 50; pointer-events: auto; border: 5px solid #FFD93D;
            animation: popIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
        }
        @keyframes popIn { from{transform:translate(-50%,-50%) scale(0.5);opacity:0} to{transform:translate(-50%,-50%) scale(1);opacity:1} }
        .quiz-modal h2 { color: #FF6B6B; font-size: 28px; margin-bottom: 20px; text-align: center; }
        .quiz-question { font-size: 22px; color: #333; margin-bottom: 25px; text-align: center; line-height: 1.4; }
        .quiz-answers { display: flex; flex-direction: column; gap: 15px; }
        .quiz-answer {
            padding: 15px 25px; background: #FFF8E1; border: 3px solid #FFD93D;
            border-radius: 15px; cursor: pointer; font-size: 20px; font-family: inherit;
            transition: all 0.2s; text-align: center;
        }
        .quiz-answer:hover { background: #FFD93D; transform: scale(1.02); }
        .quiz-answer.correct { background: #6BCB77; color: white; border-color: #4CAF50; }
        .quiz-answer.wrong { background: #FF6B6B; color: white; border-color: #F44336; }
        .hidden { display: none !important; }
        .instruction {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.95); padding: 10px 25px; border-radius: 20px;
            font-size: 16px; color: #333; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            z-index: 20; text-align: center; white-space: nowrap;
        }
        .particle {
            position: absolute; width: 12px; height: 12px; border-radius: 50%;
            animation: explode 1.2s ease-out forwards; z-index: 60;
        }
        @keyframes explode {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx),var(--ty)) scale(0); opacity: 0; }
        }
        .win-message { color: #6BCB77; font-size: 32px; margin-top: 20px; text-align: center; line-height: 1.5; }
        .restart-btn { margin-top: 30px; background: #FF6B6B; color: white; }
        /* –ö–Ω–æ–ø–∫–∞ –º—É–∑—ã–∫–∏ */
        #playMusic {
            position: absolute; bottom: 20px; right: 20px;
            padding: 12px 24px; font-size: 16px; border: none; border-radius: 25px;
            background: #FFD93D; color: #333; cursor: pointer; z-index: 30;
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: all 0.3s; display: none;
        }
        #playMusic:hover { transform: scale(1.05); background: #FFC107; }
        #playMusic.error { background: #FF6B6B; color: white; }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏ -->
    <button id="playMusic">üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
    
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div class="ui-overlay">
            <div class="score-board">üèÜ –û—á–∫–∏: <span id="score">0</span></div>
            <div class="lives-board">‚ù§Ô∏è –ñ–∏–∑–Ω–∏: <span id="lives">3</span></div>
        </div>
        <div class="pause-overlay" id="pauseOverlay"></div>

        <div class="start-screen" id="startScreen">
            <h1>ü•û –ú–∞—Å–ª–µ–Ω–∏—Ü–∞: –ª–æ–≤–∏ –±–ª–∏–Ω—ã! ü•û</h1>
            <p style="color:white;font-size:22px;margin-bottom:20px;text-align:center;max-width:800px">
                –ü–æ–º–æ–≥–∏ –ø–æ–π–º–∞—Ç—å –≤—Å–µ —É–≥–æ—â–µ–Ω–∏—è!<br>–ù–µ –ø—Ä–æ–ø—É—Å—Ç–∏ 3 –ø—Ä–µ–¥–º–µ—Ç–∞!<br>–û—Ç–≤–µ—á–∞–π –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å!
            </p>
            <div class="mode-buttons">
                <button class="btn btn-slow" onclick="startGame('slow')">üê¢ –ú–ï–î–õ–ï–ù–ù–û</button>
                <button class="btn btn-medium" onclick="startGame('medium')">üêá –°–†–ï–î–ù–ï</button>
            </div>
        </div>

        <div class="game-over-screen hidden" id="gameOverScreen">
            <h1>–û–π, –∏–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h1>
            <p style="color:white;font-size:32px">–¢–≤–æ–π —Å—á–µ—Ç: <span id="finalScore">0</span></p>
            <button class="btn restart-btn" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>

        <div class="win-screen hidden" id="winScreen">
            <h1>üéâ –ü–û–ë–ï–î–ê! üéâ</h1>
            <div class="win-message">–¢—ã –Ω–∞–±—Ä–∞–ª 50 –æ—á–∫–æ–≤!<br>–¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –∑–Ω–∞—Ç–æ–∫ –ú–∞—Å–ª–µ–Ω–∏—Ü—ã!</div>
            <button class="btn restart-btn" onclick="restartGame()">üîÑ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>

        <div class="quiz-modal hidden" id="quizModal">
            <h2>‚ùì –í–æ–ø—Ä–æ—Å –æ –ú–∞—Å–ª–µ–Ω–∏—Ü–µ</h2>
            <div class="quiz-question" id="quizQuestion"></div>
            <div class="quiz-answers" id="quizAnswers"></div>
        </div>

        <div class="instruction hidden" id="instruction">
            –£–ø—Ä–∞–≤–ª—è–π –∫–æ—Ä–∑–∏–Ω–æ–π: —Å—Ç—Ä–µ–ª–∫–∏ ‚Üê ‚Üí –∏–ª–∏ –≤–æ–¥–∏ –º—ã—à–∫–æ–π/–ø–∞–ª—å—Ü–µ–º
        </div>
    </div>

    <!-- –ê—É–¥–∏–æ: —Ñ–∞–π–ª 1.mp3 –¥–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å —Ä—è–¥–æ–º —Å index.html -->
    <audio id="bgMusic" loop preload="auto">
        <source src="1.mp3" type="audio/mpeg">
    </audio>

    <script>
        // === –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ===
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameLoop, score = 0, lives = 3, gameSpeedMode = 'slow';
        let isPlaying = false, isPaused = false, lastQuizScore = 0;

        // === –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø ===
        const images = { basket: new Image(), items: [], bg: new Image() };
        const imagePaths = {
            basket: 'images/–®1.png',
            bg: 'images/1.jpg',
            items: ['images/1.png','images/2.png','images/3.png','images/4.png','images/5.png',
                    'images/6.png','images/7.png','images/8.png','images/9.png','images/10.png']
        };
        const itemEmojis = ['üß∏','üéà','üç¨','üç≠','üç©','üç™','üé∏','üé∫','üéª','üöó'];

        function loadImages() {
            images.bg.src = imagePaths.bg;
            images.basket.src = imagePaths.basket;
            imagePaths.items.forEach((path, i) => { const img = new Image(); img.src = path; images.items[i] = img; });
        }

        // === –í–û–ü–†–û–°–´ (20 —à—Ç—É–∫) ===
        const quizzes = [
            {q:"–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–π —Å–∏–º–≤–æ–ª –ú–∞—Å–ª–µ–Ω–∏—Ü—ã?",a:["–ë–ª–∏–Ω","–ü–∏—Ä–æ–≥","–¢–æ—Ä—Ç"],c:0},
            {q:"–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–ª–∏—Ç—Å—è –ú–∞—Å–ª–µ–Ω–∏—Ü–∞?",a:["5 –¥–Ω–µ–π","7 –¥–Ω–µ–π","10 –¥–Ω–µ–π"],c:1},
            {q:"–ö–∞–∫–æ–π —Ñ–æ—Ä–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –±–ª–∏–Ω—ã?",a:["–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ","–ö—Ä—É–≥–ª—ã–µ","–¢—Ä–µ—É–≥–æ–ª—å–Ω—ã–µ"],c:1},
            {q:"–ß—Ç–æ —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç –∫—Ä—É–≥–ª—ã–π –±–ª–∏–Ω?",a:["–°–æ–ª–Ω—Ü–µ","–õ—É–Ω—É","–ó–≤–µ–∑–¥—É"],c:0},
            {q:"–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å –ú–∞—Å–ª–µ–Ω–∏—Ü—ã?",a:["–ü—Ä–æ—â–µ–Ω–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ","–ß–∏—Å—Ç—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–°–≤–µ—Ç–ª–∞—è –ø—è—Ç–Ω–∏—Ü–∞"],c:0},
            {q:"–ß—Ç–æ —Å–∂–∏–≥–∞—é—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å?",a:["–î–µ—Ä–µ–≤–æ","–ß—É—á–µ–ª–æ –∑–∏–º—ã","–°—Ç–∞—Ä—ã–µ –≤–µ—â–∏"],c:1},
            {q:"–° —á–µ–º –ù–ï –µ–¥—è—Ç –±–ª–∏–Ω—ã –Ω–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü—É?",a:["–°–æ —Å–º–µ—Ç–∞–Ω–æ–π","–° –∏–∫—Ä–æ–π","–° –∫–µ—Ç—á—É–ø–æ–º"],c:2},
            {q:"–ö–∞–∫–æ–µ –≤—Ä–µ–º—è –≥–æ–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –ú–∞—Å–ª–µ–Ω–∏—Ü—ã?",a:["–ó–∏–º–∞","–í–µ—Å–Ω–∞","–õ–µ—Ç–æ"],c:1},
            {q:"–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ –ü—Ä–æ—â–µ–Ω–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ?",a:["–ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ—â–µ–Ω–∏—è","–ü–æ–¥–∞—Ä–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏","–£—Å—Ç—Ä–æ–∏—Ç—å –ø–∏—Ä"],c:0},
            {q:"–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ–¥–µ–ª—è –ø–µ—Ä–µ–¥ –ú–∞—Å–ª–µ–Ω–∏—Ü–µ–π?",a:["–°—ã—Ä–Ω–∞—è –Ω–µ–¥–µ–ª—è","–ú—è—Å–Ω–∞—è –Ω–µ–¥–µ–ª—è","–ú–æ–ª–æ—á–Ω–∞—è –Ω–µ–¥–µ–ª—è"],c:0},
            {q:"–ö–∞–∫–æ–π –¥–µ–Ω—å –ú–∞—Å–ª–µ–Ω–∏—Ü—ã –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è '–í—Å—Ç—Ä–µ—á–∞'?",a:["–ü–µ—Ä–≤—ã–π –¥–µ–Ω—å","–¢—Ä–µ—Ç–∏–π –¥–µ–Ω—å","–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–Ω—å"],c:0},
            {q:"–ß—Ç–æ –ø–µ–∫—É—Ç –Ω–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü—É?",a:["–ë–ª–∏–Ω—ã","–ü–µ—á–µ–Ω—å–µ","–•–ª–µ–±"],c:0},
            {q:"–ö–∞–∫–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —Å–≤—è–∑–∞–Ω–æ —Å –ú–∞—Å–ª–µ–Ω–∏—Ü–µ–π?",a:["–ú–µ–¥–≤–µ–¥—å","–ó–∞—è—Ü","–õ–∏—Å–∞"],c:0},
            {q:"–ß—Ç–æ –¥–µ–ª–∞—é—Ç —Å —á—É—á–µ–ª–æ–º?",a:["–°–∂–∏–≥–∞—é—Ç","–•–æ—Ä–æ–Ω—è—Ç","–ü—Ä—è—á—É—Ç"],c:0},
            {q:"–ö–∞–∫–æ–π —Ü–≤–µ—Ç –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å –ú–∞—Å–ª–µ–Ω–∏—Ü–µ–π?",a:["–ó–æ–ª–æ—Ç–æ–π/–∂–µ–ª—Ç—ã–π","–°–∏–Ω–∏–π","–ó–µ–ª–µ–Ω—ã–π"],c:0},
            {q:"–ß—Ç–æ –Ω–µ–ª—å–∑—è –µ—Å—Ç—å –Ω–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü—É?",a:["–ú—è—Å–æ","–ú–æ–ª–æ–∫–æ","–Ø–π—Ü–∞"],c:0},
            {q:"–ö–∞–∫ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—É–ª–∞—á–Ω—ã–µ –±–æ–∏ –Ω–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü—É?",a:["–ö—É–ª–∞—á–∫–∏","–ë–æ–π","–°—Ö–≤–∞—Ç–∫–∞"],c:0},
            {q:"–ß—Ç–æ –∫–∞—Ç–∞—é—Ç —Å –≥–æ—Ä –Ω–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü—É?",a:["–ë–ª–∏–Ω—ã","–°–∞–Ω–∫–∏","–ú—è—á–∏"],c:1},
            {q:"–ö–∞–∫–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫ —Å–ª–µ–¥—É–µ—Ç –∑–∞ –ú–∞—Å–ª–µ–Ω–∏—Ü–µ–π?",a:["–ü–∞—Å—Ö–∞","–†–æ–∂–¥–µ—Å—Ç–≤–æ","–¢—Ä–æ–∏—Ü–∞"],c:0},
            {q:"–ö–∞–∫–æ–µ —É–≥–æ—â–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ —Å—Ç–æ–ª–µ?",a:["–ë–ª–∏–Ω—ã —Å –º–∞—Å–ª–æ–º","–¢–æ—Ä—Ç","–ü–∏—Ä–æ–∂–∫–∏"],c:0}
        ];

        // === –ö–û–†–ó–ò–ù–ê ===
        let basket = { x:0, y:0, width:150, height:120, speed:10 };
        let fallingItems = [], keys = {}, mouseX = null;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            basket.y = canvas.height - 130;
            basket.x = canvas.width/2 - basket.width/2;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        loadImages();

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï ===
        document.addEventListener('keydown', e => keys[e.key] = true);
        document.addEventListener('keyup', e => keys[e.key] = false);
        document.addEventListener('mousemove', e => { if(isPlaying && !isPaused) mouseX = e.clientX; });
        document.addEventListener('touchmove', e => { e.preventDefault(); if(isPlaying && !isPaused) mouseX = e.touches[0].clientX; }, {passive:false});

        // === –ü–ê–î–ê–Æ–©–ò–ï –ü–†–ï–î–ú–ï–¢–´ ===
        class FallingItem {
            constructor() {
                this.w = 70; this.h = 70;
                this.x = Math.random() * (canvas.width - this.w);
                this.y = -this.h;
                this.speed = gameSpeedMode === 'slow' ? 1 + Math.random()*0.8 : 1.8 + Math.random()*1.2;
                this.idx = Math.floor(Math.random() * 10);
                this.caught = false;
            }
            update() { this.y += this.speed; }
            draw() {
                const img = images.items[this.idx];
                if(img?.complete && img.naturalWidth) ctx.drawImage(img, this.x, this.y, this.w, this.h);
                else { ctx.font='60px Arial'; ctx.textAlign='center'; ctx.textBaseline='top'; ctx.fillText(itemEmojis[this.idx], this.x+this.w/2, this.y); }
            }
        }

        function drawBasket() {
            if(images.basket?.complete && images.basket.naturalWidth) ctx.drawImage(images.basket, basket.x, basket.y, basket.width, basket.height);
            else { ctx.font='100px Arial'; ctx.textAlign='center'; ctx.textBaseline='top'; ctx.fillText('üë®‚Äçüç≥', basket.x+basket.width/2, basket.y+10); }
        }

        // === –°–ê–õ–Æ–¢ ===
        function createFirework(x,y) {
            const colors = ['#FF6B6B','#FFD93D','#6BCB77','#4D96FF','#FF9F45'];
            for(let i=0;i<40;i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x+'px'; p.style.top = y+'px';
                p.style.background = colors[Math.floor(Math.random()*colors.length)];
                const angle = (Math.PI*2*i)/40, vel = 100+Math.random()*150;
                p.style.setProperty('--tx', Math.cos(angle)*vel+'px');
                p.style.setProperty('--ty', Math.sin(angle)*vel+'px');
                document.getElementById('gameContainer').appendChild(p);
                setTimeout(() => p.remove(), 1200);
            }
        }

        // === –ö–í–ò–ó ===
        function showQuiz() {
            isPaused = true;
            document.getElementById('pauseOverlay').style.display = 'block';
            const q = quizzes[Math.floor(Math.random()*quizzes.length)];
            document.getElementById('quizQuestion').textContent = q.q;
            const answersEl = document.getElementById('quizAnswers');
            answersEl.innerHTML = '';
            q.a.forEach((ans, idx) => {
                const btn = document.createElement('button');
                btn.className = 'quiz-answer';
                btn.textContent = ans;
                btn.onclick = () => checkAnswer(idx, q.c, btn);
                answersEl.appendChild(btn);
            });
            document.getElementById('quizModal').classList.remove('hidden');
        }

        function checkAnswer(selected, correct, btn) {
            document.querySelectorAll('.quiz-answer').forEach(b => b.disabled = true);
            if(selected === correct) {
                btn.classList.add('correct');
                setTimeout(closeQuiz, 1000);
            } else {
                btn.classList.add('wrong');
                document.querySelectorAll('.quiz-answer')[correct].classList.add('correct');
                score = Math.max(0, score - 5);
                updateUI();
                setTimeout(closeQuiz, 1500);
            }
        }

        function closeQuiz() {
            document.getElementById('quizModal').classList.add('hidden');
            document.getElementById('pauseOverlay').style.display = 'none';
            isPaused = false;
            lastQuizScore = score;
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            if(score > 0 && score % 5 === 0 && score !== lastQuizScore && !isPaused) showQuiz();
            if(score >= 50 && document.getElementById('winScreen').classList.contains('hidden')) winGame();
        }

        // === –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ===
        function gameStep() {
            if(!isPlaying) return;
            if(isPaused) { gameLoop = requestAnimationFrame(gameStep); return; }
            
            ctx.clearRect(0,0,canvas.width,canvas.height);
            
            if(mouseX !== null) basket.x = mouseX - basket.width/2;
            if(keys['ArrowLeft']||keys['a']||keys['A']) { basket.x -= basket.speed; mouseX = null; }
            if(keys['ArrowRight']||keys['d']||keys['D']) { basket.x += basket.speed; mouseX = null; }
            basket.x = Math.max(0, Math.min(canvas.width - basket.width, basket.x));
            
            drawBasket();
            
            if(Math.random() < 0.015) fallingItems.push(new FallingItem());
            
            for(let i = fallingItems.length-1; i >= 0; i--) {
                const item = fallingItems[i];
                item.update(); item.draw();
                
                if(!item.caught && item.x < basket.x+basket.width && item.x+item.w > basket.x &&
                   item.y+item.h > basket.y && item.y < basket.y+basket.height) {
                    item.caught = true; score++; updateUI(); fallingItems.splice(i,1); continue;
                }
                if(item.y > canvas.height) {
                    lives--; updateUI(); fallingItems.splice(i,1);
                    if(lives <= 0) gameOver();
                }
            }
            gameLoop = requestAnimationFrame(gameStep);
        }

        // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ===
        function startGame(mode) {
            if(gameLoop) cancelAnimationFrame(gameLoop);
            document.getElementById('playMusic').style.display = 'block';
            document.getElementById('playMusic').className = '';
            document.getElementById('playMusic').textContent = 'üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
            
            gameSpeedMode = mode;
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('instruction').classList.remove('hidden');
            isPlaying = true; isPaused = false; score = 0; lives = 3;
            fallingItems = []; lastQuizScore = 0; mouseX = null;
            updateUI(); gameStep();
        }

        function gameOver() {
            isPlaying = false; cancelAnimationFrame(gameLoop);
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            const audio = document.getElementById('bgMusic');
            audio.pause(); audio.currentTime = 0;
        }

        function winGame() {
            isPlaying = false; cancelAnimationFrame(gameLoop);
            for(let i=0;i<5;i++) setTimeout(() => createFirework(Math.random()*canvas.width, Math.random()*canvas.height/2), i*400);
            document.getElementById('winScreen').classList.remove('hidden');
            document.getElementById('bgMusic').pause();
        }

        function restartGame() {
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('winScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            document.getElementById('instruction').classList.add('hidden');
            document.getElementById('pauseOverlay').style.display = 'none';
            
            const audio = document.getElementById('bgMusic');
            audio.pause(); audio.currentTime = 0;
            document.getElementById('playMusic').style.display = 'block';
            document.getElementById('playMusic').className = '';
            document.getElementById('playMusic').textContent = 'üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
            
            score = 0; lives = 3; fallingItems = []; updateUI();
        }

        // === –ú–£–ó–´–ö–ê (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è GitHub Pages) ===
        document.getElementById('playMusic').addEventListener('click', async function() {
            const audio = document.getElementById('bgMusic');
            const btn = this;
            
            // –ï—Å–ª–∏ –∞—É–¥–∏–æ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ‚Äî –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å
            if(audio.readyState === 0) audio.load();
            
            try {
                await audio.play();
                btn.style.display = 'none'; // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –ø—Ä–∏ —É—Å–ø–µ—Ö–µ
                console.log('‚úÖ Music playing');
            } catch(err) {
                console.error('‚ùå Audio error:', err);
                btn.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–≤—É–∫–∞';
                btn.className = 'error';
                
                if(err.name === 'NotFoundError' || audio.error) {
                    alert('‚ùå –§–∞–π–ª 1.mp3 –Ω–µ –Ω–∞–π–¥–µ–Ω!\n\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:\n1. –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ GitHub\n2. –ù–∞–∑—ã–≤–∞–µ—Ç—Å—è 1.mp3 (–º–∞–ª–µ–Ω—å–∫–∏–º–∏ –±—É–∫–≤–∞–º–∏)\n3. –õ–µ–∂–∏—Ç –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ, —á—Ç–æ index.html');
                } else if(err.name === 'NotAllowedError') {
                    alert('üîá –ë—Ä–∞—É–∑–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∑–≤—É–∫.\n\n–ö–ª–∏–∫–Ω–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–Ω–æ–≤–∞.');
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message + '\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
                }
            }
        });

        // === –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ===
        window.onload = () => { resizeCanvas(); loadImages(); };
    </script>
</body>
</html>
